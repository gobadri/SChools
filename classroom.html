<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" type="image/x-icon" href="assets/favicon.svg">
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
    
    <!-- Custom CSS -->
    <!-- <link rel="stylesheet" href="style.css"> -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Anton&family=IBM+Plex+Sans+Arabic:wght@100;200;300;400;500;600;700&display=swap" rel="stylesheet">
    <script type="text/javascript">
        // document.oncontextmenu = new Function("return false;");
        // document.onselectstart = new Function("return false;");
    </script>

    <style>
        .text-muted{
            color: #aaa !important;
        }
        
        /* Animated effects for lighting simulation */
        .classroom-img {
            transition: opacity 0.8s ease, filter 0.5s;
        }
        
        .blurred {
            filter: blur(5px);
            opacity: 0.4;
        }
        
        .flicker {
            animation: flickerAnim 0.2s infinite;
        }
        
        @keyframes flickerAnim {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.6; }
        }
        
        #appendImage {
            position: relative;
            overflow: hidden;
        }
        
        #appendImage canvas {
            transition: all 0.5s ease-in-out;
            max-height: 400px;
            object-fit: cover;
            width: 100%;
        }
        
        /* Canvas-based lighting effects */
        .lighting-canvas {
            display: block;
            max-width: 100%;
            height: auto;
        }
    </style>
    <title>SChools - Classroom Simulator</title>
</head>

<body class="bg-dark text-white">
    <!-- Credits Section -->
    <div class="position-fixed top-50 end-0 translate-middle-y bg-light text-dark p-3 rounded-start shadow" style="z-index: 1050;">
        <div class="text-center mb-2">
            <p class="mb-0 small fw-bold">Powered by</p>
        </div>
        <a href="https://shortcircuitcompany.com" target="_blank">
            <img src="assets/SClogo.svg" alt="this application is powered by Short Circuit Company" class="img-fluid" style="max-width: 60px;">
        </a>
    </div>
    
    <!-- Header -->
    <header class="border-bottom border-light">
        <div class="container-fluid">
            <div class="row align-items-center py-3">
                <div class="col-md-6">
                    <a href="index.html">
                        <img src="assets/logo-Light.svg" alt="Logo" class="img-fluid" style="max-height: 40px;">
                    </a>
                </div>
                <div class="col-md-6">
                    <nav class="navbar navbar-expand-lg navbar-dark">
                        <div class="container-fluid">
                            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                                <span class="navbar-toggler-icon"></span>
                            </button>
                            <div class="collapse navbar-collapse" id="navbarNav">
                                <ul class="navbar-nav ms-auto align-items-center">
                                    <li class="nav-item">
                                        <a class="nav-link" href="about.html">About SChools</a>
                                    </li>
                                    <li class="nav-item">
                                        <a class="nav-link" href="Documentation.html">Documentation</a>
                                    </li>
                                    <li class="nav-item">
                                        <button class="btn btn-link nav-link" popovertarget="contactus">Contact us</button>
                                    </li>
                                    <li class="nav-item">
                                        <a href="https://facebook.com/shortcircuiteg" target="_blank" class="nav-link">
                                            <img src="assets/facebook-logo.svg" alt="facebook" class="img-fluid" style="width: 20px; filter: brightness(0) invert(1);">
                                        </a>
                                    </li>
                                    <li class="nav-item">
                                        <a href="https://instagram.com/shortcircuiteg" target="_blank" class="nav-link">
                                            <img src="assets/instagram-logo.svg" alt="instagram" class="img-fluid" style="width: 20px; filter: brightness(0) invert(1);">
                                        </a>
                                    </li>
                                    <li class="nav-item">
                                        <a href="https://www.linkedin.com/company/short-circuit-company" target="_blank" class="nav-link">
                                            <img src="assets/linkedin-logo.svg" alt="linkedin" class="img-fluid" style="width: 20px; filter: brightness(0) invert(1);">
                                        </a>
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </nav>
                </div>
            </div>
        </div>
    </header>

    <main class="container-fluid">
        <!-- Selected Data Display -->
        <div class="row mt-4">
            <div class="col-12">
                <div class="card bg-secondary bg-opacity-25 text-white border-0 rounded-4 p-3">
                    <div class="card-body">
                        <h4 class="text-danger mb-3">Selected Parameters</h4>
                        <div id="selectedDataDisplay" class="row text-white">
                            <!-- Selected data will be displayed here -->
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Simulator Hero -->
        <div class="row mt-4">
            <div class="col-12 position-relative">
                <img src="assets/ChatGPT Image Aug 3, 2025, 11_32_14 PM.png" alt="Classroom Background" class="img-fluid w-100" style="max-height: 400px; object-fit: cover;">
                <div class="position-absolute top-0 start-0 w-100 h-100 bg-dark bg-opacity-50"></div>
            </div>
        </div>

        <!-- Controls Section -->
        <div class="row justify-content-center mt-4">
            <div class="col-lg-8 col-md-10 col-12">
                <div class="card bg-secondary text-white bg-opacity-25 border-0 rounded-4 p-4">
                    <div class="card-body">
                        <h3 class="text-center text-danger mb-4">Lighting Controls</h3>
                        
                        <div class="row g-4">
                            <div class="col-md-6">
                                <div class="controller">
                                    <label for="cctSlider" class="form-label">
                                        CCT (K): <span id="cctValue" class="text-warning">6500</span>
                                        <small class="text-muted d-block" id="cctRange">Range: Loading...</small>
                                    </label>
                                    <input type="range" id="cctSlider" class="form-range" min="1000" max="10000" value="6500" step="100">
                                </div>
                            </div>
                            
                            <div class="col-md-6">
                                <div class="controller">
                                    <label for="criSlider" class="form-label">
                                        CRI: <span id="criValue" class="text-warning">80</span>
                                        <small class="text-muted d-block" id="criRange">Range: Loading...</small>
                                    </label>
                                    <input type="range" id="criSlider" class="form-range" min="0" max="100" value="80" step="1">
                                </div>
                            </div>
                            
                            <div class="col-md-6">
                                <div class="controller">
                                    <label for="flickerSlider" class="form-label">
                                        Flicker (%): <span id="flickerValue" class="text-warning">90</span>
                                        <small class="text-muted d-block" id="flickerRange">Range: Loading...</small>
                                    </label>
                                    <input type="range" id="flickerSlider" class="form-range" min="0" max="100" value="1" step=".5">
                                </div>
                            </div>
                            
                            <div class="col-md-6">
                                <div class="controller">
                                    <label for="glareSlider" class="form-label">
                                        Glare (UGR): <span id="glareValue" class="text-warning">6</span>
                                        <small class="text-muted d-block" id="glareRange">Range: Loading...</small>
                                    </label>
                                    <input type="range" id="glareSlider" class="form-range" min="1" max="28" value="6" step="1">
                                </div>
                            </div>
                            
                            <div class="col-md-6">
                                <div class="controller">
                                    <label for="uniformitySlider" class="form-label">
                                        Uniformity: <span id="uniformityValue" class="text-warning">0.7</span>
                                        <small class="text-muted d-block" id="uniformityRange">Range: Loading...</small>
                                    </label>
                                    <input type="range" id="uniformitySlider" class="form-range" min="0" max="1" value="0.7" step="0.1">
                                </div>
                            </div>
                            
                            <div class="col-md-6">
                                <div class="controller">
                                    <label for="melanopicSlider" class="form-label">
                                        Melanopic EDI: <span id="melanopicValue" class="text-warning">200</span>
                                        <small class="text-muted d-block" id="melanopicRange">Range: Loading...</small>
                                    </label>
                                    <input type="range" id="melanopicSlider" class="form-range" min="0" max="500" value="200" step="10">
                                </div>
                            </div>
                            
                            <div class="col-md-6">
                                <div class="controller">
                                    <label for="verticalSlider" class="form-label">
                                        Vertical Illuminance (lux): <span id="verticalValue" class="text-warning">300</span>
                                        <small class="text-muted d-block" id="verticalRange">Range: Loading...</small>
                                    </label>
                                    <input type="range" id="verticalSlider" class="form-range" min="0" max="1000" value="300" step="10">
                                </div>
                            </div>
                            
                            <div class="col-md-6">
                                <div class="controller">
                                    <label for="exposureSlider" class="form-label">
                                        Exposure Duration (hours): <span id="exposureValue" class="text-warning">8</span>
                                        <small class="text-muted d-block" id="exposureRange">Range: Loading...</small>
                                    </label>
                                    <input type="range" id="exposureSlider" class="form-range" min="1" max="24" value="8" step="1">
                                </div>
                            </div>
                            
                            <div class="col-md-6">
                                <div class="controller">
                                    <label for="luxSlider" class="form-label">
                                        Lux: <span id="luxValue" class="text-warning">500</span>
                                        <small class="text-muted d-block" id="luxRange">Range: Loading...</small>
                                    </label>
                                    <input type="range" id="luxSlider" class="form-range" min="0" max="1000" value="500" step="10">
                                </div>
                            </div>
                        </div>

                        <div class="text-center mt-4">
                            <button type="button" class="btn btn-danger btn-lg px-5" onclick="compareValues()">
                                Compare with Recommendations
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <div class="col-lg-4 col-md-12 col-12">
                <div class="appendImage" id="appendImage">
                    <canvas id="lightingCanvas" class="lighting-canvas"></canvas>
                </div>
            </div>
        </div>

        <!-- Comparison Results -->
        <div class="row mt-4">
            <div class="col-12">
                <div id="comparisonResults" class="card bg-dark border-secondary rounded-4" style="display: none;">
                    <div class="card-body">
                        <h4 class="text-danger mb-3">Comparison Results</h4>
                        <div id="comparisonContent">
                            <!-- Comparison results will be displayed here -->
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Information Cards -->
        <div class="row mt-5">
            <div class="col-12">
                <div class="row g-4">
                    <div class="col-lg-3 col-md-6">
                        <div class="card bg-secondary bg-opacity-25 border-0 rounded-4 h-100">
                            <div class="card-body">
                                <h5 class="text-danger">CCT (Color Temperature)</h5>
                                <p class="text-light">Color temperature affects mood and concentration. Warmer temperatures (2700K-3000K) are better for young children.</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-lg-3 col-md-6">
                        <div class="card bg-secondary bg-opacity-25 border-0 rounded-4 h-100">
                            <div class="card-body">
                                <h5 class="text-danger">CRI (Color Rendering Index)</h5>
                                <p class="text-light">CRI measures how accurately colors are rendered. Higher CRI (90+) is essential for educational activities.</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-lg-3 col-md-6">
                        <div class="card bg-secondary bg-opacity-25 border-0 rounded-4 h-100">
                            <div class="card-body">
                                <h5 class="text-danger">Flicker</h5>
                                <p class="text-light">Flicker can cause eye strain and headaches. Lower flicker percentages are better for learning environments.</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-lg-3 col-md-6">
                        <div class="card bg-secondary bg-opacity-25 border-0 rounded-4 h-100">
                            <div class="card-body">
                                <h5 class="text-danger">Glare (UGR)</h5>
                                <p class="text-light">Unified Glare Rating measures visual comfort. Lower UGR values provide better visual comfort.</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-lg-3 col-md-6">
                        <div class="card bg-secondary bg-opacity-25 border-0 rounded-4 h-100">
                            <div class="card-body">
                                <h5 class="text-danger">Uniformity</h5>
                                <p class="text-light">Uniformity measures the consistency of lighting across a space. Higher values indicate more even lighting distribution.</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-lg-3 col-md-6">
                        <div class="card bg-secondary bg-opacity-25 border-0 rounded-4 h-100">
                            <div class="card-body">
                                <h5 class="text-danger">Melanopic EDI</h5>
                                <p class="text-light">Melanopic Equivalent Daylight Illuminance affects circadian rhythms and alertness. Higher values promote better wakefulness.</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-lg-3 col-md-6">
                        <div class="card bg-secondary bg-opacity-25 border-0 rounded-4 h-100">
                            <div class="card-body">
                                <h5 class="text-danger">Vertical Illuminance</h5>
                                <p class="text-light">Vertical illuminance measures light falling on vertical surfaces. Important for visual comfort and task performance.</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-lg-3 col-md-6">
                        <div class="card bg-secondary bg-opacity-25 border-0 rounded-4 h-100">
                            <div class="card-body">
                                <h5 class="text-danger">Exposure Duration</h5>
                                <p class="text-light">Exposure duration affects the cumulative impact of lighting on health and performance. Longer exposure requires more careful consideration.</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-lg-3 col-md-6">
                        <div class="card bg-secondary bg-opacity-25 border-0 rounded-4 h-100">
                            <div class="card-body">
                                <h5 class="text-danger">Lux (Illuminance)</h5>
                                <p class="text-light">Lux measures the amount of light falling on a surface. Proper illuminance levels are crucial for visual comfort and task performance.</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL" crossorigin="anonymous"></script>

    <script>
        // Global variables
        let selectedGrade = '';
        let selectedEnvironment = '';
        let apiData = null;
        
        // Canvas variables for lighting effects
        let canvas = null;
        let ctx = null;
        let originalImageData = null;
        let classroomImage = null;

        // Function to get cookie value
        function getCookie(name) {
            const value = `; ${document.cookie}`;
            const parts = value.split(`; ${name}=`);
            if (parts.length === 2) return parts.pop().split(';').shift();
            return null;
        }

        // Function to load selected data from cookies
        function loadSelectedData() {
            selectedGrade = getCookie('selectedGrade');
            selectedEnvironment = getCookie('selectedEnvironment');
            
            if (!selectedGrade || !selectedEnvironment) {
                alert('No selection data found. Please go back to the main page and make a selection.');
                window.location.href = 'index.html';
                return;
            }

            // Display selected data
            const displayDiv = document.getElementById('selectedDataDisplay');
            displayDiv.innerHTML = `
                <div class="col-md-6">
                    <p><strong class="text-warning">Grade:</strong> ${selectedGrade}</p>
                </div>
                <div class="col-md-6">
                    <p><strong class="text-warning">Environment:</strong> ${selectedEnvironment}</p>
                </div>
            `;

            // Load API data
            loadApiData();
        }

        // Function to load API data
        async function loadApiData() {
            try {
                const response = await fetch('api/data.json');
                apiData = await response.json();
                
                // Set slider ranges based on API data for the selected grade
                setSliderRanges();
            } catch (error) {
                console.error('Failed to load API data:', error);
                alert('Failed to load lighting data. Please try again.');
            }
        }

        // Function to set slider ranges based on API data
        function setSliderRanges() {
            if (!apiData || !selectedGrade) return;
            
            const gradeData = apiData[selectedGrade];
            
            // Set ranges for each parameter
            if (gradeData.CCT) {
                const cctSlider = document.getElementById('cctSlider');
                const cctMin = Math.min(...gradeData.CCT.map(r => r.range.min));
                const cctMax = Math.max(...gradeData.CCT.map(r => r.range.max));
                cctSlider.min = cctMin;
                cctSlider.max = cctMax;
                
                // Find a "good" range and set default to middle of that range
                const goodRange = gradeData.CCT.find(r => r.rating === 'good');
                if (goodRange) {
                    cctSlider.value = Math.round((goodRange.range.min + goodRange.range.max) / 2);
                } else {
                    cctSlider.value = Math.round((cctMin + cctMax) / 2);
                }
                document.getElementById('cctValue').textContent = cctSlider.value;
                document.getElementById('cctRange').textContent = `Range: ${cctMin} - ${cctMax} K`;
            }
            
            if (gradeData.CRI) {
                const criSlider = document.getElementById('criSlider');
                const criMin = Math.min(...gradeData.CRI.map(r => r.range.min));
                const criMax = Math.max(...gradeData.CRI.map(r => r.range.max));
                criSlider.min = criMin;
                criSlider.max = criMax;
                
                // Find a "good" range and set default to middle of that range
                const goodRange = gradeData.CRI.find(r => r.rating === 'good');
                if (goodRange) {
                    criSlider.value = Math.round((goodRange.range.min + goodRange.range.max) / 2);
                } else {
                    criSlider.value = Math.round((criMin + criMax) / 2);
                }
                document.getElementById('criValue').textContent = criSlider.value;
                document.getElementById('criRange').textContent = `Range: ${criMin} - ${criMax}`;
            }
            
            if (gradeData.Flicker) {
                const flickerSlider = document.getElementById('flickerSlider');
                const flickerMin = Math.min(...gradeData.Flicker.map(r => r.range.min));
                const flickerMax = Math.max(...gradeData.Flicker.map(r => r.range.max));
                flickerSlider.min = flickerMin;
                flickerSlider.max = flickerMax;
                
                // Find a "good" range and set default to middle of that range
                const goodRange = gradeData.Flicker.find(r => r.rating === 'good');
                if (goodRange) {
                    flickerSlider.value = Math.round((goodRange.range.min + goodRange.range.max) / 2);
                } else {
                    flickerSlider.value = Math.round((flickerMin + flickerMax) / 2);
                }
                document.getElementById('flickerValue').textContent = flickerSlider.value;
                document.getElementById('flickerRange').textContent = `Range: ${flickerMin} - ${flickerMax}%`;
            }
            
            if (gradeData.UGR) {
                const glareSlider = document.getElementById('glareSlider');
                const glareMin = Math.min(...gradeData.UGR.map(r => r.range.min));
                const glareMax = Math.max(...gradeData.UGR.map(r => r.range.max));
                glareSlider.min = glareMin;
                glareSlider.max = glareMax;
                
                // Find a "good" range and set default to middle of that range
                const goodRange = gradeData.UGR.find(r => r.rating === 'good');
                if (goodRange) {
                    glareSlider.value = Math.round((goodRange.range.min + goodRange.range.max) / 2);
                } else {
                    glareSlider.value = Math.round((glareMin + glareMax) / 2);
                }
                document.getElementById('glareValue').textContent = glareSlider.value;
                document.getElementById('glareRange').textContent = `Range: ${glareMin} - ${glareMax}`;
            }
            
            // New parameters
            if (gradeData.Uniformity) {
                const uniformitySlider = document.getElementById('uniformitySlider');
                const uniformityMin = Math.min(...gradeData.Uniformity.map(r => r.range.min));
                const uniformityMax = Math.max(...gradeData.Uniformity.map(r => r.range.max));
                uniformitySlider.min = uniformityMin;
                uniformitySlider.max = uniformityMax;
                
                // Find a "good" range and set default to middle of that range
                const goodRange = gradeData.Uniformity.find(r => r.rating === 'good');
                if (goodRange) {
                    uniformitySlider.value = ((goodRange.range.min + goodRange.range.max) / 2).toFixed(1);
                } else {
                    uniformitySlider.value = ((uniformityMin + uniformityMax) / 2).toFixed(1);
                }
                document.getElementById('uniformityValue').textContent = uniformitySlider.value;
                document.getElementById('uniformityRange').textContent = `Range: ${uniformityMin} - ${uniformityMax}`;
            }
            
            if (gradeData.Melanopic_EDI) {
                const melanopicSlider = document.getElementById('melanopicSlider');
                const melanopicMin = Math.min(...gradeData.Melanopic_EDI.map(r => r.range.min));
                const melanopicMax = Math.max(...gradeData.Melanopic_EDI.map(r => r.range.max));
                melanopicSlider.min = melanopicMin;
                melanopicSlider.max = melanopicMax;
                
                // Find a "good" range and set default to middle of that range
                const goodRange = gradeData.Melanopic_EDI.find(r => r.rating === 'good');
                if (goodRange) {
                    melanopicSlider.value = Math.round((goodRange.range.min + goodRange.range.max) / 2);
                } else {
                    melanopicSlider.value = Math.round((melanopicMin + melanopicMax) / 2);
                }
                document.getElementById('melanopicValue').textContent = melanopicSlider.value;
                document.getElementById('melanopicRange').textContent = `Range: ${melanopicMin} - ${melanopicMax}`;
            }
            
            if (gradeData.Vertical_Illuminance) {
                const verticalSlider = document.getElementById('verticalSlider');
                const verticalMin = Math.min(...gradeData.Vertical_Illuminance.map(r => r.range.min));
                const verticalMax = Math.max(...gradeData.Vertical_Illuminance.map(r => r.range.max));
                verticalSlider.min = verticalMin;
                verticalSlider.max = verticalMax;
                
                // Find a "good" range and set default to middle of that range
                const goodRange = gradeData.Vertical_Illuminance.find(r => r.rating === 'good');
                if (goodRange) {
                    verticalSlider.value = Math.round((goodRange.range.min + goodRange.range.max) / 2);
                } else {
                    verticalSlider.value = Math.round((verticalMin + verticalMax) / 2);
                }
                document.getElementById('verticalValue').textContent = verticalSlider.value;
                document.getElementById('verticalRange').textContent = `Range: ${verticalMin} - ${verticalMax} lux`;
            }
            
            if (gradeData.Exposure_Duration) {
                const exposureSlider = document.getElementById('exposureSlider');
                const exposureMin = Math.min(...gradeData.Exposure_Duration.map(r => r.range.min));
                const exposureMax = Math.max(...gradeData.Exposure_Duration.map(r => r.range.max));
                exposureSlider.min = exposureMin;
                exposureSlider.max = exposureMax;
                
                // Find a "good" range and set default to middle of that range
                const goodRange = gradeData.Exposure_Duration.find(r => r.rating === 'good');
                if (goodRange) {
                    exposureSlider.value = Math.round((goodRange.range.min + goodRange.range.max) / 2);
                } else {
                    exposureSlider.value = Math.round((exposureMin + exposureMax) / 2);
                }
                document.getElementById('exposureValue').textContent = exposureSlider.value;
                document.getElementById('exposureRange').textContent = `Range: ${exposureMin} - ${exposureMax} hours`;
            }
            
            if (gradeData.Lux) {
                const luxSlider = document.getElementById('luxSlider');
                const luxMin = Math.min(...gradeData.Lux.map(r => r.range.min));
                const luxMax = Math.max(...gradeData.Lux.map(r => r.range.max));
                luxSlider.min = luxMin;
                luxSlider.max = luxMax;
                
                // Find a "good" range and set default to middle of that range
                const goodRange = gradeData.Lux.find(r => r.rating === 'good');
                if (goodRange) {
                    luxSlider.value = Math.round((goodRange.range.min + goodRange.range.max) / 2);
                } else {
                    luxSlider.value = Math.round((luxMin + luxMax) / 2);
                }
                document.getElementById('luxValue').textContent = luxSlider.value;
                document.getElementById('luxRange').textContent = `Range: ${luxMin} - ${luxMax} lux`;
            }
            
            // Apply initial visual effects after setting all slider ranges
            setTimeout(() => {
                applyVisualEffects();
            }, 100);
        }

        // Function to update slider values
        function updateSliderValue(sliderId, valueId) {
            const slider = document.getElementById(sliderId);
            const valueSpan = document.getElementById(valueId);
            
            slider.addEventListener('input', function() {
                valueSpan.textContent = this.value;
                applyVisualEffects(); // Apply visual effects when slider changes
            });
        }
        
        // Function to apply visual effects to the classroom image
        function applyVisualEffects() {
            if (!canvas || !ctx || !originalImageData) return;
            
            // Get current slider values
            const cct = parseInt(document.getElementById('cctSlider').value);
            const cri = parseInt(document.getElementById('criSlider').value);
            const flicker = parseInt(document.getElementById('flickerSlider').value);
            const glare = parseInt(document.getElementById('glareSlider').value);
            
            // Apply canvas-based lighting effects
            processImageWithLighting(cct, cri, glare, flicker);
            
            // Apply flicker animation if needed
            if (flicker > 30) {
                canvas.classList.add('flicker');
            } else {
                canvas.classList.remove('flicker');
            }
            
            // Apply blur effect for extreme conditions
            if (glare > 60 || flicker > 50) {
                canvas.classList.add('blurred');
            } else {
                canvas.classList.remove('blurred');
            }
        }

        // Function to compare values with API recommendations
        function compareValues() {
            if (!apiData || !selectedGrade) {
                alert('Please wait for data to load or go back to make a selection.');
                return;
            }

            const gradeData = apiData[selectedGrade];
            const currentValues = {
                CCT: parseInt(document.getElementById('cctSlider').value),
                CRI: parseInt(document.getElementById('criSlider').value),
                Flicker: parseInt(document.getElementById('flickerSlider').value),
                UGR: parseInt(document.getElementById('glareSlider').value),
                Uniformity: parseFloat(document.getElementById('uniformitySlider').value),
                Melanopic_EDI: parseInt(document.getElementById('melanopicSlider').value),
                Vertical_Illuminance: parseInt(document.getElementById('verticalSlider').value),
                Exposure_Duration: parseInt(document.getElementById('exposureSlider').value),
                Lux: parseInt(document.getElementById('luxSlider').value)
            };

            let comparisonHTML = '<div class="row g-3">';
            for (let param in gradeData) {
                if (param === 'age_range') continue;
                const currentValue = currentValues[param];
                const recommendations = gradeData[param];

                let bestMatch = null;
                let bestRating = 'unknown';
                recommendations.forEach((rec) => {
                    if (currentValue >= rec.range.min && currentValue <= rec.range.max) {
                        bestMatch = rec;
                        bestRating = rec.rating;
                    }
                });

                comparisonHTML += `
                    <div class="col-md-6 col-lg-4 mb-4">
                        <div class="card bg-secondary bg-opacity-25 border-0 rounded-3 h-100">
                            <div class="card-body">
                                <h5 class="text-info mb-3">${param}</h5>
                                <p class="text-white"><strong class="text-warning">Current Value:</strong> ${currentValue} ${getUnit(param)}</p>
                                ${bestMatch ? `
                                    <div class="alert ${bestRating === 'good' ? 'alert-success' : 'alert-danger'} mt-2">
                                        <strong>Rating:</strong> ${bestRating.toUpperCase()}<br>
                                        <strong>Reason:</strong> ${bestMatch.reason}<br>
                                        <strong>Recommendation:</strong> ${bestMatch.recommendation}
                                    </div>
                                ` : `
                                    <div class="alert alert-warning mt-2">
                                        <strong>Rating:</strong> UNKNOWN<br>
                                        <strong>Note:</strong> Current value doesn't match any specific range in our recommendations.
                                    </div>
                                `}
                            </div>
                        </div>
                    </div>
                `;
            }
            comparisonHTML += '</div>';
            document.getElementById('comparisonContent').innerHTML = comparisonHTML;
            document.getElementById('comparisonResults').style.display = 'block';
        }

        // Function to get unit for parameter
        function getUnit(param) {
            const units = {
                'CCT': 'K',
                'CRI': '',
                'Flicker': '%',
                'UGR': '',
                'Uniformity': '',
                'Melanopic_EDI': '',
                'Vertical_Illuminance': 'lux',
                'Exposure_Duration': 'hours',
                'Lux': 'lux'
            };
            return units[param] || '';
        }

        // Initialize canvas and load classroom image
        function initializeCanvas() {
            canvas = document.getElementById('lightingCanvas');
            ctx = canvas.getContext('2d');
            
            // Load classroom image
            classroomImage = new Image();
            classroomImage.onload = function() {
                // Set canvas size to match image
                canvas.width = classroomImage.width;
                canvas.height = classroomImage.height;
                
                // Draw original image
                ctx.drawImage(classroomImage, 0, 0);
                
                // Store original pixel data
                originalImageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
                
                // Apply initial lighting effects
                applyVisualEffects();
            };
            classroomImage.onerror = function() {
                console.error('Failed to load classroom image');
            };
            // classroomImage.src = 'classroom/images/sample.jpg';
            // classroomImage.src = 'assets/catalogue.png';
            classroomImage.src = 'assets/secondary.jpg';
        }
        
        // Linear interpolation function
        function lerp(a, b, t) {
            return a + (b - a) * t;
        }
        
        // Clamp value to valid range (0-255 for pixel values)
        function clamp(value) {
            return Math.max(0, Math.min(255, Math.round(value)));
        }
        
        // Process image with lighting effects
        function processImageWithLighting(cct, cri, glare, flicker) {
            if (!originalImageData) return;
            
            // Create a copy of original image data
            const imageData = new ImageData(new Uint8ClampedArray(originalImageData.data), originalImageData.width, originalImageData.height);
            const data = imageData.data;
            
            // Calculate CCT color temperature effects using proper Kelvin scale
            const kelvin = cct;
            let redMultiplier = 1.0;
            let greenMultiplier = 1.0;
            let blueMultiplier = 1.0;
            
            // Apply color temperature based on Kelvin scale
            if (kelvin <= 2000) {
                // Very warm (candlelight) - strong red, weak blue
                redMultiplier = 1.8;
                greenMultiplier = 0.8;
                blueMultiplier = 0.4;
            } else if (kelvin <= 3000) {
                // Warm (incandescent) - red dominant
                redMultiplier = 1.6;
                greenMultiplier = 0.9;
                blueMultiplier = 0.5;
            } else if (kelvin <= 4000) {
                // Warm white - slight red tint
                redMultiplier = 1.3;
                greenMultiplier = 1.0;
                blueMultiplier = 0.7;
            } else if (kelvin <= 5000) {
                // Neutral white
                redMultiplier = 1.1;
                greenMultiplier = 1.0;
                blueMultiplier = 0.9;
            } else if (kelvin <= 6000) {
                // Cool white - slight blue tint
                redMultiplier = 0.9;
                greenMultiplier = 1.0;
                blueMultiplier = 1.1;
            } else if (kelvin <= 7000) {
                // Cool (daylight) - blue dominant
                redMultiplier = 0.7;
                greenMultiplier = 0.9;
                blueMultiplier = 1.3;
            } else {
                // Very cool (overcast sky) - strong blue
                redMultiplier = 0.5;
                greenMultiplier = 0.8;
                blueMultiplier = 1.6;
            }
            
            // Calculate glare brightness factor with dramatic increase above 19
            let brightnessMultiplier = 1.0;
            if (glare <= 19) {
                // Normal brightness for low glare
                brightnessMultiplier = 1.0 + (glare / 19) * 0.3; // 1.0 to 1.3
            } else {
                // Dramatic brightness increase above 19
                const highGlareFactor = (glare - 19) / 9; // 0-1 for range 19-28
                brightnessMultiplier = 1.3 + (highGlareFactor * 2.7); // 1.3 to 4.0 brightness
            }
            
            // Process each pixel
            for (let i = 0; i < data.length; i += 4) {
                let r = data[i];     // Red channel
                let g = data[i + 1]; // Green channel
                let b = data[i + 2]; // Blue channel
                
                // Apply CCT color temperature
                r = clamp(r * redMultiplier);
                g = clamp(g * greenMultiplier);
                b = clamp(b * blueMultiplier);
                
                // Apply glare brightness
                r = clamp(r * brightnessMultiplier);
                g = clamp(g * brightnessMultiplier);
                b = clamp(b * brightnessMultiplier);
                
                // Calculate CRI effects
                const criFactor = cri / 100; // Normalize CRI to 0-1
                const avg = (r + g + b) / 3; // Calculate average brightness
                
                // CRI simulation: lower CRI reduces color accuracy
                if (cri < 95) {
                    r = lerp(r, avg, 1 - criFactor);
                    g = lerp(g, avg, 1 - criFactor);
                    b = lerp(b, avg, 1 - criFactor);
                }
                
                // Desaturate colors based on CRI
                r = lerp(r, avg, 0.5 * (1 - criFactor));
                g = lerp(g, avg, 0.5 * (1 - criFactor));
                b = lerp(b, avg, 0.5 * (1 - criFactor));
                
                // Store processed pixel values
                data[i] = clamp(r);
                data[i + 1] = clamp(g);
                data[i + 2] = clamp(b);
            }
            
            // Draw processed image back to canvas
            ctx.putImageData(imageData, 0, 0);
        }
        
        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', function() {
            loadSelectedData();
            initializeCanvas();
            
            // Set up slider event listeners
            updateSliderValue('cctSlider', 'cctValue');
            updateSliderValue('criSlider', 'criValue');
            updateSliderValue('flickerSlider', 'flickerValue');
            updateSliderValue('glareSlider', 'glareValue');
            updateSliderValue('uniformitySlider', 'uniformityValue');
            updateSliderValue('melanopicSlider', 'melanopicValue');
            updateSliderValue('verticalSlider', 'verticalValue');
            updateSliderValue('exposureSlider', 'exposureValue');
            updateSliderValue('luxSlider', 'luxValue');
        });
    </script>
</body>
</html>